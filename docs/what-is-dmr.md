# DMR in Baidu Inc

DMR框架是一个（日志）数据分析框架，可以简单理解为从日志数据到报表数据（不含呈现）这个处理过程需要的一系列工具的集合。

**1、与SPY、Speedup、Gaia的区别？**

这些平台都是集合了数据分析处理及展现功能的封闭平台，并有专人同学维护，如果业务要分析数据或建设报表都需要向这些平台提需求，平台承载及扩展能力是有限，很难满足临时追查及精细分析的场景。

而DMR更像是一个工具，囊括了处理数据所需要模式、方法、指标，提供给不同角色的同学（RD、OP、PM），让大家具备自行分析数据、建设报表的能力。

同时DMR是充分开源的，设计模式上充分借鉴了流编程和包扩展，对前端开发者的门槛很低。

**2、与ShowX的区别？**

DMR目前完全不考虑展现，这些事情ShowX、Echarts等框架已经做的很好，就交给他们好了，但是DMR会推出报表数据 > ShowX API的接口，使得DMR + ShowX成为一套完整的数据分析与呈现的解决方案。

**DMR和ShowX其实刚好是互补关系**。

**3、DMR是基于Node写的，适合其他生产角色吗？**

目前DMR会提供2种使用方式完成数据分析功能：

- 编写config配置，通过bin命令行工具启动（类似Grunt），推荐RD、OP角色使用
- 直接引用DMR包或DMR插件库，进行TS/JS开发（类似Glup、FIS），推荐FE角色使用

后种模式完成数据分析同样会生成config配置，这让其他角色可以一样理解分析过程并复用。

如果发展顺利，DMR会提供可视化的界面（CLI）帮助用户形成配置，方便更多非技术类角色使用。

**4、配置（config）是什么东西？**

配置包含了处理数据过程所需的各种信息，比如LOG源（FTP/HADOOP/HTTP等）、日志格式解析、过滤算法、统计算法、任务的日程等等。配置另一个层面理解就是DMR框架的输入。不同的机器使用DMR框架用同一份配置就能得到一样的结果，使用者还可以共享部分或全部配置比如某个LOG源、某个任务等等。


**框架开源 + 配置共享** 是DMR核心的设计思想。模板就是降低KPI维护者的成本，又能对指标整体掌控；另一方面愿意投入短期人力及资源换取产品数据及分析能力的第三方都能够低成本介入

**5、DMR的其他特性**

时效性：基于流的分析，最快能够做到从源到报表界面的实时更新

伸缩性：DMR推荐是用于单机分析，但是DMR最大的优势是模块化及配置化设计完全能够实现将任务分布式运作，比如配置拆分成Map及 Reduce两个阶段就可以基于Haddop愉悦地工作。分布式计算或者闲置计算资源共享也可能是DMR发展的一个方向（当然前提是有这样的需求场景）。

扩展性：DMR数据处理的过程就是node transferorm流结合配置项对数据逐步变形。DMR已经定义好变形前后的I/O格式，二次开发只要基于I/O格式开发node插件或其他能处理流的脚本就可以（如Bash、Python）。

**6、DMR目前的结构**

主框架（DMR）：bin、日程管理、config读取、任务启动等

源（[DMR-SOURCE](https://github.com/node-dmr/dmr-source)）：日志源的抽象

管道（DMR-PIPELINE）：处理过程的管道，主要用来连接源、中间件

中间件（[DMR-MIDDLEWARE](https://github.com/node-dmr/dmr-middleware)）：提供各种处理数据模式的工具

**7、目前的进度**

DMR在18年4月份开始开发，7月初产出了第一版（0.5），用于Ac、简单、部分Speedup调研数据分析，功能是满足了，但是整体设计上不尽如人意，表现就是对外的API及Config配置非常晦涩。

9月初开始新版的重构，同时已经重构完的部分（[MIDDLEWARE](https://github.com/node-dmr/dmr-middleware)/PIPELINE/[SOURCE](https://github.com/node-dmr/dmr-source)）均符合开源标准（100%单测+API Docs+持续集成），同时代码用**Typescript**重新实现，改掉了很多JS编码的陋习，设计模式及对外接口清晰，为后续的更好的扩展进行铺垫，预计10月中旬完成。
